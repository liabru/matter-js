{"version":3,"sources":["/gif.coffee","/browser.coffee","events"],"names":["h","c","f","b","e","a","d","ImageData","CanvasRenderingContext2D","WebGLRenderingContext","Error","console","Math","Worker","Uint8Array","k","m","Blob","document","navigator","parseFloat","parseInt","EventEmitter","Array","isArray","Object","prototype","toString","call","setMaxListeners","_events","maxListeners","emit","error","length","arguments","slice","g","apply","addListener","warned","undefined","trace","push","on","once","removeListener","indexOf","splice","removeAllListeners","listeners"],"mappings":"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","sourceRoot":"../src","sourcesContent":["{EventEmitter} = require 'events'\nbrowser = require './browser.coffee'\n\nclass GIF extends EventEmitter\n\n  defaults =\n    workerScript: 'gif.worker.js'\n    workers: 2\n    repeat: 0 # repeat forever, -1 = repeat once\n    background: '#fff'\n    quality: 10 # pixel sample interval, lower is better\n    width: null # size derermined from first frame if possible\n    height: null\n    transparent: null\n\n  frameDefaults =\n    delay: 500 # ms\n    copy: false\n\n  constructor: (options) ->\n    @running = false\n\n    @options = {}\n    @frames = []\n\n    @freeWorkers = []\n    @activeWorkers = []\n\n    @setOptions options\n    for key, value of defaults\n      @options[key] ?= value\n\n  setOption: (key, value) ->\n    @options[key] = value\n    if @_canvas? and key in ['width', 'height']\n      @_canvas[key] = value\n\n  setOptions: (options) ->\n    @setOption key, value for own key, value of options\n\n  addFrame: (image, options={}) ->\n    frame = {}\n    frame.transparent = @options.transparent\n    for key of frameDefaults\n      frame[key] = options[key] or frameDefaults[key]\n\n    # use the images width and height for options unless already set\n    @setOption 'width', image.width unless @options.width?\n    @setOption 'height', image.height unless @options.height?\n\n    if ImageData? and image instanceof ImageData\n       frame.data = image.data\n    else if (CanvasRenderingContext2D? and image instanceof CanvasRenderingContext2D) or (WebGLRenderingContext? and image instanceof WebGLRenderingContext)\n      if options.copy\n        frame.data = @getContextData image\n      else\n        frame.context = image\n    else if image.childNodes?\n      if options.copy\n        frame.data = @getImageData image\n      else\n        frame.image = image\n    else\n      throw new Error 'Invalid image'\n\n    @frames.push frame\n\n  render: ->\n    throw new Error 'Already running' if @running\n\n    if not @options.width? or not @options.height?\n      throw new Error 'Width and height must be set prior to rendering'\n\n    @running = true\n    @nextFrame = 0\n    @finishedFrames = 0\n\n    @imageParts = (null for i in [0...@frames.length])\n    numWorkers = @spawnWorkers()\n    @renderNextFrame() for i in [0...numWorkers]\n\n    @emit 'start'\n    @emit 'progress', 0\n\n  abort: ->\n    loop\n      worker = @activeWorkers.shift()\n      break unless worker?\n      console.log \"killing active worker\"\n      worker.terminate()\n    @running = false\n    @emit 'abort'\n\n  # private\n\n  spawnWorkers: ->\n    numWorkers = Math.min(@options.workers, @frames.length)\n    [@freeWorkers.length...numWorkers].forEach (i) =>\n      console.log \"spawning worker #{ i }\"\n      worker = new Worker @options.workerScript\n      worker.onmessage = (event) =>\n        @activeWorkers.splice @activeWorkers.indexOf(worker), 1\n        @freeWorkers.push worker\n        @frameFinished event.data\n      @freeWorkers.push worker\n    return numWorkers\n\n  frameFinished: (frame) ->\n    console.log \"frame #{ frame.index } finished - #{ @activeWorkers.length } active\"\n    @finishedFrames++\n    @emit 'progress', @finishedFrames / @frames.length\n    @imageParts[frame.index] = frame\n    if null in @imageParts\n      @renderNextFrame()\n    else\n      @finishRendering()\n\n  finishRendering: ->\n    len = 0\n    for frame in @imageParts\n      len += (frame.data.length - 1) * frame.pageSize + frame.cursor\n    len += frame.pageSize - frame.cursor\n    console.log \"rendering finished - filesize #{ Math.round(len / 1000) }kb\"\n    data = new Uint8Array len\n    offset = 0\n    for frame in @imageParts\n      for page, i in frame.data\n        data.set page, offset\n        if i is frame.data.length - 1\n          offset += frame.cursor\n        else\n          offset += frame.pageSize\n\n    image = new Blob [data],\n      type: 'image/gif'\n\n    @emit 'finished', image, data\n\n  renderNextFrame: ->\n    throw new Error 'No free workers' if @freeWorkers.length is 0\n    return if @nextFrame >= @frames.length # no new frame to render\n\n    frame = @frames[@nextFrame++]\n    worker = @freeWorkers.shift()\n    task = @getTask frame\n\n    console.log \"starting frame #{ task.index + 1 } of #{ @frames.length }\"\n    @activeWorkers.push worker\n    worker.postMessage task#, [task.data.buffer]\n\n  getContextData: (ctx) ->\n    return ctx.getImageData(0, 0, @options.width, @options.height).data\n\n  getImageData: (image) ->\n    if not @_canvas?\n      @_canvas = document.createElement 'canvas'\n      @_canvas.width = @options.width\n      @_canvas.height = @options.height\n\n    ctx = @_canvas.getContext '2d'\n    ctx.setFill = @options.background\n    ctx.fillRect 0, 0, @options.width, @options.height\n    ctx.drawImage image, 0, 0\n\n    return @getContextData ctx\n\n  getTask: (frame) ->\n    index = @frames.indexOf frame\n    task =\n      index: index\n      last: index is (@frames.length - 1)\n      delay: frame.delay\n      transparent: frame.transparent\n      width: @options.width\n      height: @options.height\n      quality: @options.quality\n      repeat: @options.repeat\n      canTransfer: (browser.name is 'chrome')\n\n    if frame.data?\n      task.data = frame.data\n    else if frame.context?\n      task.data = @getContextData frame.context\n    else if frame.image?\n      task.data = @getImageData frame.image\n    else\n      throw new Error 'Invalid frame'\n\n    return task\n\nmodule.exports = GIF\n","### CoffeeScript version of the browser detection from MooTools ###\n\nua = navigator.userAgent.toLowerCase()\nplatform = navigator.platform.toLowerCase()\nUA = ua.match(/(opera|ie|firefox|chrome|version)[\\s\\/:]([\\w\\d\\.]+)?.*?(safari|version[\\s\\/:]([\\w\\d\\.]+)|$)/) or [null, 'unknown', 0]\nmode = UA[1] == 'ie' && document.documentMode\n\nbrowser =\n  name: if UA[1] is 'version' then UA[3] else UA[1]\n  version: mode or parseFloat(if UA[1] is 'opera' && UA[4] then UA[4] else UA[2])\n\n  platform:\n    name: if ua.match(/ip(?:ad|od|hone)/) then 'ios' else (ua.match(/(?:webos|android)/) or platform.match(/mac|win|linux/) or ['other'])[0]\n\nbrowser[browser.name] = true\nbrowser[browser.name + parseInt(browser.version, 10)] = true\nbrowser.platform[browser.platform.name] = true\n\nmodule.exports = browser\n","if (!process.EventEmitter) process.EventEmitter = function () {};\n\nvar EventEmitter = exports.EventEmitter = process.EventEmitter;\nvar isArray = typeof Array.isArray === 'function'\n    ? Array.isArray\n    : function (xs) {\n        return Object.prototype.toString.call(xs) === '[object Array]'\n    }\n;\n\n// By default EventEmitters will print a warning if more than\n// 10 listeners are added to it. This is a useful default which\n// helps finding memory leaks.\n//\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nvar defaultMaxListeners = 10;\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!this._events) this._events = {};\n  this._events.maxListeners = n;\n};\n\n\nEventEmitter.prototype.emit = function(type) {\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events || !this._events.error ||\n        (isArray(this._events.error) && !this._events.error.length))\n    {\n      if (arguments[1] instanceof Error) {\n        throw arguments[1]; // Unhandled 'error' event\n      } else {\n        throw new Error(\"Uncaught, unspecified 'error' event.\");\n      }\n      return false;\n    }\n  }\n\n  if (!this._events) return false;\n  var handler = this._events[type];\n  if (!handler) return false;\n\n  if (typeof handler == 'function') {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        var args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n    return true;\n\n  } else if (isArray(handler)) {\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    var listeners = handler.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n      listeners[i].apply(this, args);\n    }\n    return true;\n\n  } else {\n    return false;\n  }\n};\n\n// EventEmitter is defined in src/node_events.cc\n// EventEmitter.prototype.emit() is also defined there.\nEventEmitter.prototype.addListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('addListener only takes instances of Function');\n  }\n\n  if (!this._events) this._events = {};\n\n  // To avoid recursion in the case that type == \"newListeners\"! Before\n  // adding it to the listeners, first emit \"newListeners\".\n  this.emit('newListener', type, listener);\n\n  if (!this._events[type]) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  } else if (isArray(this._events[type])) {\n\n    // Check for listener leak\n    if (!this._events[type].warned) {\n      var m;\n      if (this._events.maxListeners !== undefined) {\n        m = this._events.maxListeners;\n      } else {\n        m = defaultMaxListeners;\n      }\n\n      if (m && m > 0 && this._events[type].length > m) {\n        this._events[type].warned = true;\n        console.error('(node) warning: possible EventEmitter memory ' +\n                      'leak detected. %d listeners added. ' +\n                      'Use emitter.setMaxListeners() to increase limit.',\n                      this._events[type].length);\n        console.trace();\n      }\n    }\n\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  } else {\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  var self = this;\n  self.on(type, function g() {\n    self.removeListener(type, g);\n    listener.apply(this, arguments);\n  });\n\n  return this;\n};\n\nEventEmitter.prototype.removeListener = function(type, listener) {\n  if ('function' !== typeof listener) {\n    throw new Error('removeListener only takes instances of Function');\n  }\n\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (!this._events || !this._events[type]) return this;\n\n  var list = this._events[type];\n\n  if (isArray(list)) {\n    var i = list.indexOf(listener);\n    if (i < 0) return this;\n    list.splice(i, 1);\n    if (list.length == 0)\n      delete this._events[type];\n  } else if (this._events[type] === listener) {\n    delete this._events[type];\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  // does not use listeners(), so no side effect of creating _events[type]\n  if (type && this._events && this._events[type]) this._events[type] = null;\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  if (!this._events) this._events = {};\n  if (!this._events[type]) this._events[type] = [];\n  if (!isArray(this._events[type])) {\n    this._events[type] = [this._events[type]];\n  }\n  return this._events[type];\n};\n"]}